<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seed Counter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Simple earthy styling -->
    <style>
        :root {
            --bg: #f4f1ea;
            --bg-alt: #f0e7d8;
            --card-bg: #ffffff;
            --accent: #4f772d;
            --accent-soft: #90a955;
            --accent-dark: #31572c;
            --text-main: #2b2b2b;
            --text-muted: #66625a;
            --border: #d6cbb5;
            --error: #b72c2c;
        }

        * {
            box-sizing: border-box;
        }

	.hero .muted {
    color: #ffffff !important;
    opacity: 0.95;
}


        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: var(--bg);
            color: var(--text-main);
        }

        a {
            color: var(--accent-dark);
        }

        .hero {
            position: relative;
            min-height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #fff;
            background-image:
                linear-gradient(to bottom, rgba(0,0,0,0.45), rgba(0,0,0,0.55)),
                url("{{ url_for('static', filename='img/header_wheat.jpg') }}");
            background-size: cover;
            background-position: center;
            padding: 2.5rem 1rem 2rem;
        }

        .hero-inner {
            max-width: 900px;
        }

        .hero h1 {
            margin: 0 0 0.5rem;
            font-size: 2.1rem;
            letter-spacing: 0.03em;
        }

        .hero p {
            margin: 0.2rem 0;
            font-size: 1rem;
            opacity: 0.92;
        }

        .main-container {
            max-width: 1100px;
            margin: 1.5rem auto 2.5rem;
            padding: 0 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.6rem 1.4rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 0.6rem;
            font-size: 1.35rem;
            color: var(--accent-dark);
        }

        .card h3 {
            margin-top: 0;
            margin-bottom: 0.4rem;
            font-size: 1.1rem;
            color: var(--accent);
        }

        .muted {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .error {
            background: #ffe5e5;
            border: 1px solid #f3b1b1;
            color: var(--error);
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-pill {
            background: var(--bg-alt);
            border-radius: 999px;
            padding: 0.5rem 0.9rem;
            font-size: 0.9rem;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            font-size: 0.95rem;
        }

        input[type="file"],
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 0.45rem 0.55rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-size: 0.95rem;
            margin-top: 0.2rem;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: 2px solid var(--accent-soft);
            border-color: var(--accent-soft);
        }

        button {
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.55rem 1.3rem;
            font-size: 0.95rem;
            cursor: pointer;
            margin-top: 0.4rem;
        }

        button:hover {
            background: var(--accent-dark);
        }

        button.secondary {
            background: transparent;
            color: var(--accent-dark);
            border: 1px solid var(--accent-soft);
        }

        button.secondary:hover {
            background: var(--accent-soft);
            color: #fff;
        }

        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.7rem;
            margin-top: 0.7rem;
        }

        .help-list {
            padding-left: 1.1rem;
            margin: 0.4rem 0 0.1rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .help-list li {
            margin-bottom: 0.25rem;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.8rem 1rem;
            margin-bottom: 0.7rem;
        }

        .calc-result {
            margin-top: 0.5rem;
            padding: 0.6rem 0.8rem;
            background: var(--bg-alt);
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .footer {
            text-align: center;
            padding: 1.8rem 1rem 2rem;
            background: #f8f4ec;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .footer strong {
            color: var(--accent-dark);
        }
    </style>
</head>
<body>

<header class="hero">
    <div class="hero-inner">
        <h1>Seed Counter</h1>
        <p>Fast seed counts and seeding-rate guidance for wheat, barley, lentils and canola.</p>
        <p class="muted">Upload a photo of seeds on paper, then use the calculator to target the right plant stand.</p>
    </div>
</header>

<main class="main-container">

    <div class="grid">
        <!-- Seed counting card -->
        <section class="card">
            <h2>1. Image seed counter</h2>

            {% if error %}
                <div class="error">{{ error }}</div>
            {% endif %}

            <div class="stats-row">
                <div class="stat-pill">
                    Last image: <strong>{{ seed_count if seed_count is not none else "–" }}</strong> seeds
                </div>
                <div class="stat-pill">
                    Session total: <strong>{{ total_seeds or 0 }}</strong> seeds
                </div>
                <div class="stat-pill">
                    Current crop: <strong>{{ current_crop|capitalize }}</strong>
                </div>
            </div>

            <form method="post" enctype="multipart/form-data">
                <label>
                    Crop for this image
                    <select name="crop">
                        <option value="wheat"   {% if current_crop == 'wheat' %}selected{% endif %}>Wheat</option>
                        <option value="barley"  {% if current_crop == 'barley' %}selected{% endif %}>Barley</option>
                        <option value="lentils" {% if current_crop == 'lentils' %}selected{% endif %}>Lentils</option>
                        <option value="canola"  {% if current_crop == 'canola' %}selected{% endif %}>Canola</option>
                    </select>
                </label>

                <label for="image">
                    Seed image
                    <input type="file" name="image" id="image" accept="image/*" required>
                </label>

                <div class="button-row">
                    <button type="submit">Add image to total</button>
                </div>
            </form>

            <form method="post" style="margin-top: 0.6rem;">
                <input type="hidden" name="reset" value="1">
                <input type="hidden" name="crop" value="{{ current_crop }}">
                <button type="submit" class="secondary">Clear all counts</button>
            </form>

            <p class="muted" style="margin-top: 0.8rem;">
                Tip: take photos in soft, even light on a clean white sheet. Spread seeds so they’re not touching
                for the most accurate counts.
            </p>
        </section>

        <!-- Seed rate calculator (front-end only) -->
        <section class="card">
            <h2>2. Seed-rate calculator</h2>
            <p class="muted">Uses thousand-seed weight and target plants/m² to estimate kg/ha.</p>

            <div class="calc-grid">
                <div>
                    <label for="calcCrop">Crop</label>
                    <select id="calcCrop">
                        <option value="wheat">Wheat</option>
                        <option value="barley">Barley</option>
                        <option value="lentils">Lentils</option>
                        <option value="canola">Canola</option>
                    </select>
                </div>

                <div>
                    <label for="tsw">Thousand-seed weight (g)</label>
                    <input type="number" id="tsw" step="0.1" min="1" placeholder="e.g. 40">
                </div>

                <div>
                    <label for="targetPlants">Target plants per m²</label>
                    <input type="number" id="targetPlants" step="1" min="10" placeholder="e.g. 180">
                </div>

                <div>
                    <label for="germ">Lab germination (%)</label>
                    <input type="number" id="germ" step="1" min="1" max="100" placeholder="e.g. 95">
                </div>

                <div>
                    <label for="establish">Field establishment (%)</label>
                    <input type="number" id="establish" step="1" min="1" max="100" placeholder="e.g. 85">
                </div>
            </div>

            <div class="calc-result" id="calcOutput">
                Enter values to see kg/ha. The calculator stays on your device – nothing is sent to the server.
            </div>

            <p class="muted" style="margin-top: 0.5rem;">
                Formula: <code>kg/ha = TSW (g) × target plants/m² × 10 ÷ (germ_frac × establish_frac)</code>
                where germ_frac and establish_frac are the decimal forms of the percentages.
            </p>
        </section>
    </div>

    <!-- Help / info card -->
    <section class="card" style="margin-top: 1.5rem;">
        <h2>3. Photo tips & notes</h2>

        <h3>Photo setup</h3>
        <ul class="help-list">
            <li>Use a plain white sheet or tray with no printing or creases if possible.</li>
            <li>Spread seeds so they’re not touching; take multiple photos for large counts.</li>
            <li>Use soft, even light (overcast outside or indoor diffuse light). Avoid strong shadows.</li>
            <li>Hold the phone directly above the seeds, not at an angle.</li>
        </ul>

        <h3>About this tool</h3>
        <p class="muted">
            This tool is designed to help growers and agronomists quickly estimate seed counts and
            seeding rates in the paddock or office. Always cross-check against your own experience and
            adjust for local conditions, soil type and seasonal risk.
        </p>
    </section>

</main>

<footer class="footer">
    <p><strong>JTH Agritech · Seed Counter</strong></p>
    <p>Built by Jake Hull.</p>
    <p>
        Contact:
        <a href="mailto:jake@westcoastag.com.au">jake@westcoastag.com.au</a>
    </p>
</footer>

<!-- Front-end seed-rate calculator logic -->
<script>
    function updateCalculatorDefaults() {
        const crop = document.getElementById('calcCrop').value;
        const tsw = document.getElementById('tsw');
        const target = document.getElementById('targetPlants');

        if (!tsw.value && !target.value) {
            if (crop === 'wheat') {
                tsw.placeholder = 'e.g. 40';
                target.placeholder = 'e.g. 180';
            } else if (crop === 'barley') {
                tsw.placeholder = 'e.g. 45';
                target.placeholder = 'e.g. 170';
            } else if (crop === 'lentils') {
                tsw.placeholder = 'e.g. 60';
                target.placeholder = 'e.g. 130';
            } else if (crop === 'canola') {
                tsw.placeholder = 'e.g. 4';
                target.placeholder = 'e.g. 60';
            }
        }
        calculateSeedRate();
    }

    function calculateSeedRate() {
        const tsw = parseFloat(document.getElementById('tsw').value);
        const target = parseFloat(document.getElementById('targetPlants').value);
        const germ = parseFloat(document.getElementById('germ').value);
        const establish = parseFloat(document.getElementById('establish').value);
        const output = document.getElementById('calcOutput');

        if (isNaN(tsw) || isNaN(target) || isNaN(germ) || isNaN(establish)) {
            output.textContent = 'Enter thousand-seed weight, target plants/m², germination and establishment to calculate kg/ha.';
            return;
        }

        const germFrac = germ / 100.0;
        const establishFrac = establish / 100.0;

        if (germFrac <= 0 || establishFrac <= 0) {
            output.textContent = 'Germination and establishment percentages must be greater than zero.';
            return;
        }

        // kg/ha = TSW(g) * target_plants_per_m2 * 10 / (germ_frac * establish_frac)
        const kgHa = tsw * target * 10.0 / (germFrac * establishFrac);

        output.textContent = 'Suggested seeding rate: ' + kgHa.toFixed(1) + ' kg/ha (rounded).';
    }

    document.getElementById('calcCrop').addEventListener('change', updateCalculatorDefaults);
    ['tsw','targetPlants','germ','establish'].forEach(id => {
        document.getElementById(id).addEventListener('input', calculateSeedRate);
    });

    // Initialise placeholders
    updateCalculatorDefaults();
</script>

</body>
</html>
